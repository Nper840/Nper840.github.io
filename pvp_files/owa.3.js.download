self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.3.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[3],{261:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return a}));var r=n(173),o=null,c=3e4;function i(){return null==o&&(o=new r.Cache),o}function u(e){return i().get(e)}function s(e){return i().del(e)}function a(e,t){i().put(e,t,c)}},391:function(e,t,n){"use strict";n.r(t);var r=n(449),o=n(0),c=n(173),i=n(266),u=n(125),s=n(318),a=n(48),l="OWA_GetDelegationAccessToken",d={};function f(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:t=encodeURIComponent(e.client_id+e.scope+e.requestId),n={},r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,h(e,window,t)];case 2:return n=r.sent(),[3,5];case 3:return r.sent(),n.TokenResultCode=2,[3,5];case 4:return function(e,t){var n=t.document.getElementById(e);null!=n&&(n.removeEventListener("load",d[e]),t.document.body.removeChild(n),delete d[e])}(t,window),[7];case 5:return[2,n]}}))}))}function h(e,t,n){return Object(o.__awaiter)(this,void 0,void 0,(function(){var r,c;return Object(o.__generator)(this,(function(o){return r=function(e){var t={response_type:"token",prompt:"none",redirect_uri:e.redirect_uri,scope:e.scope,client_id:e.client_id};return e.authorization_uri+"?"+i.stringify(t)}(e),t.document.getElementById(n)?[2,{TokenResultCode:2}]:((c=t.document.createElement("iframe")).src=r.toString(),c.style.display="none",c.id=n,t.document.body.appendChild(c),[2,new Promise((function(r,o){d[n]=function(n){var u={};try{c.contentWindow&&c.contentWindow.location.host==t.location.host&&(u=function(e,t){var n=i.parse(e),r={};n.access_token?(r.AccessToken=n.access_token,r.AccessTokenExpiry=Object(s.a)(Date.now(),parseInt(n.expires_in)).toISOString(),r.TokenResultCode=0):"login_required"==n.error||"interaction_required"==n.error||"consent_required"==n.error?(r.TokenResultCode=3,Object(a.h)(l+" MSA Failure Unauthorized",{error:n.error,param:e,requestId:t})):(r.TokenResultCode=2,Object(a.h)(l+" MSA Failure",{error:n.error,param:e,requestId:t}));return r}(c.contentWindow.location.hash.substring(1),e.requestId))}catch(t){Object(a.h)(l+" Hash Param Parsing Failure ",{err:t.toString(),message:t.message,stk:t.stack||"",scope:e.scope,uri:e.redirect_uri,requestId:e.requestId}),u.TokenResultCode=2,o(u)}r(u)},c.addEventListener("load",d[n],!1)}))])}))}))}var b,_=n(18),v=n(261),p=n(439),g=3,T=1500;function k(e){return new Promise((function(t,n){(null==b&&(b=new p.a(g,O,T)),b).add({onFulfilled:t,onRejected:n,options:e})}))}function O(e){return f(e.options).then((function(t){e.onFulfilled(t)})).catch((function(t){e.onRejected(t)})),Promise.resolve()}var j=n(165),A=n(219),w=null,m="OWA_GetDelegationAccessToken",I="https://login.live.com/oauth20_authorize.srf",R="/owa/auth/dt.aspx",C="292841";function y(e,t,n){return Object(o.__awaiter)(this,void 0,void 0,(function(){var r,c,s,l,d;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:r={scope:e,client_id:"",authorization_uri:"",redirect_uri:"",requestId:n||Object(A.a)()},o.label=1;case 1:return o.trys.push([1,7,,8]),Object(_.i)("auth-disableGetAuthenticationCall")?[4,S(q(r))]:[3,3];case 2:return c=o.sent(),[3,6];case 3:return[4,Object(u.a)({})];case 4:return 0!=(s=o.sent()).ResultCode||null==s.ImplicitGrantAuthorizationUrl||""==s.ImplicitGrantAuthorizationUrl?(Object(a.h)(m+" ImplicitGrantAuthorizationUrl is empty or null ",{scope:e,correlationId:r.requestId}),[2,c]):(l=i.parse(s.ImplicitGrantAuthorizationUrl.split("?")[1]||"")).client_id&&l.redirect_uri?(r.client_id=l.client_id,r.authorization_uri=s.ImplicitGrantAuthorizationUrl.split("?")[0],r.redirect_uri=l.redirect_uri,[4,S(r,t)]):[3,6];case 5:c=o.sent(),o.label=6;case 6:return[2,c];case 7:return d=o.sent(),Object(a.h)(m+" GetDelegationToken Operation failed ",{err:d.toString(),message:d.message,stk:d.stack||"",scope:e,requestId:r.requestId,api:t}),[2,c];case 8:return[2]}}))}))}function S(e,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,r,c,i;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return n=e.client_id+e.scope,(null==(r=function(e,t){var n=e.get(t),r=void 0;if(null==n?void 0:n.AccessTokenExpiry){new Date(n.AccessTokenExpiry)>new Date(Date.now())&&(r=n)}return r}(D(),n))?void 0:r.AccessToken)?[2,r.AccessToken]:[3,1];case 1:return Object(_.i)("auth-getDelegationTokenQueueEnabled")?(c=Object(v.a)(n),i=void 0,c?i=c:(i=k(e),Object(v.b)(n,i)),[2,i.then((function(e){return E(n,e),Object(v.c)(n),e.AccessToken})).catch((function(r){Object(v.c)(n),Object(a.h)(m,{category:"Promise_For_Token_Request_Failed",err:r?r.toString():"",message:r?r.message:"",scope:e.scope,requestId:e.requestId,api:t})}))]):[3,2];case 2:return[4,f(e)];case 3:return r=o.sent(),E(n,r),[2,0==r.TokenResultCode?r.AccessToken:void 0]}}))}))}function E(e,t){if(t&&0==t.TokenResultCode&&t.AccessTokenExpiry){var n=new Date(t.AccessTokenExpiry).getTime()-Date.now();n>0&&D().put(e,t,n)}}function D(){return null==w&&(w=new c.Cache),w}function q(e){return e.redirect_uri=Object(j.a)()+R,e.authorization_uri=I,e.client_id=C,e}var x=n(8),U=n(421);var F=!1;function P(){var e;F||(e=Object(U.a)("/owa"),Object(x.b)({baseUrl:e}),F=!0)}var z={NoUserLogin:"AADSTS50058",InvalidResourceUrl:"AADSTS50001",NoPreAuth:"AADSTS65001",UserAborted:"AADSTS65004",NotConsent:"AADSTS70011"};function G(e,t,n,r,o){n?e.acquireTokenPopup(t,null,n,o):e.acquireToken(t,(function(n,c){n&&n.indexOf(z.NoPreAuth)>=0&&r?e.acquireTokenPopup(t,null,null,o):o(n,c)}))}var N=n(37),L=new N.c((function(){return n.e(487).then(n.bind(null,17676))})),W=new N.a(L,(function(e){return e.createAdalAuthenticationContext}));function B(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return e="https://login.microsoftonline.com/",[4,Object(u.a)({})];case 1:return 0===(null==(t=o.sent())?void 0:t.ResultCode)&&(null==t?void 0:t.AuthenticationUrl)&&(r=t.AuthenticationUrl.split("/"),n=r[0]+"//"+r[2]+"/"),[2,n||e]}}))}))}var Q=function(e,t,n,r,o){return function(c,i){c||!i?o(c,null):(e.getCachedUser(),G(e,t,n,r,o))}},M="adalIdTokenFrame";function $(e,t,n,r,o){e.config.displayCall=function(c){!function(e){if(-1==e.indexOf("?"))throw new Error("Invalid Url in Adal Auth Context Display Call")}(c),window.detectUserCachedCallback=Q(e,t,n,r,o),function(e,t){e._addAdalFrame(M).src="about:blank",e._loadFrame(t+"&prompt=none",M)}(e,c)},e.login()}var H=n(17);function J(e,t,n,r,c,i){var u,s;return Object(o.__awaiter)(this,void 0,void 0,(function(){var a,l,d,f,h;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,B()];case 1:return a=o.sent(),[4,W.importAndExecute(a,e,t)];case 2:return l=o.sent(),d=Object(H.a)(),f=null===(u=d.SessionSettings)||void 0===u?void 0:u.UserPrincipalName,h=null===(s=d.SessionSettings)||void 0===s?void 0:s.UserEmailAddress,l._user={profile:{upn:f||h}},l.getCachedUser()?G(l,n,r,c,i):$(l,n,r,c,i),[2]}}))}))}n.d(t,"getAccessTokenforResource",(function(){return r.b})),n.d(t,"getAccessTokenforResourceAsLazy",(function(){return r.c})),n.d(t,"getDelegationTokenForOwa",(function(){return y})),n.d(t,"bootstrap",(function(){return P})),n.d(t,"getAccessTokenOnBehalfOfResource",(function(){return J})),n.d(t,"AdalErrorCode",(function(){return z}))},449:function(e,t,n){"use strict";var r=n(0),o=n(173),c=n(319),i=n(318);function u(e){return Object(r.__assign)({__type:"TokenRequest:#Exchange"},e)}var s=n(129),a=n(30);function l(e,t){return void 0===e||e.__type||(e=u(e)),Object(a.a)("GetAccessTokenforResource",e,t)}var d=n(360),f=n(165),h=n(171),b=n(321),_="OWA_GetAccessTokenForResource";function v(e,t,n,o,c){var s,a;return Object(r.__awaiter)(this,void 0,void 0,(function(){var v,p,g,T,k,O;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,Object(d.a)()];case 1:return(v=r.sent())&&e==Object(f.a)()?[2,{AccessToken:v}]:Object(b.a)("opxComponentLifecycle")?(p=Object(h.a)(),(g=p.isResourceTokenPrefetchEnabled)?[4,p.isResourceTokenPrefetchEnabled()]:[3,3]):[3,6];case 2:g=r.sent(),r.label=3;case 3:return g?(k=p.getResourceToken)?[4,p.getResourceToken(e)]:[3,5]:[3,6];case 4:k=r.sent(),r.label=5;case 5:if((T=k)&&T.length>0&&"bearer"===(null===(s=T.split(" ")[0])||void 0===s?void 0:s.toLowerCase())&&(null===(a=T.split(" ")[1])||void 0===a?void 0:a.length)>0)return[2,{AccessToken:T.split(" ")[1],TokenResultCode:0,ExpiresIn:3600,AccessTokenExpiry:Object(i.a)(Date.now(),3600).toISOString()}];r.label=6;case 6:return O={isUserActivity:!1,datapoint:{customData:{Scenario:_,Resource_Url:e,Retry_attempt:t,Request_Id:n,Target_Tenant_Id:c||"",Api:o||""},headersCustomData:function(e){return{TokenResultDetails:e.get("x-tokenresult")||""}},jsonCustomData:function(e){var t;return{TokenStatus:(null===(t=null==e?void 0:e.TokenResultCode)||void 0===t?void 0:t.toString())||2}}},returnFullResponseOnSuccess:!0},[4,l(u({Resource:e,UserToken:v,TargetTenantId:c}),O)];case 7:return[4,r.sent().json()];case 8:return[2,r.sent()]}}))}))}function p(e,t,n,o,c,i){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(r){return t<1?[2,Promise.reject()]:[2,v(e,t,o,c,i).catch((function(r){return Object(s.a)(n).then((function(){return p(e,t-1,2*n,o,c,i)}))}))]}))}))}var g,T=n(18),k=n(439),O=3,j=500;function A(e,t,n,r){return new Promise((function(o,c){(null==g&&(g=new k.a(O,w,j)),g).add({onFulfilled:o,onRejected:c,resource:e,requestId:t,apiName:n,targetTenantId:r})}))}function w(e){return U(e.resource,e.apiName,e.requestId,e.targetTenantId).then((function(t){e.onFulfilled(t)})).catch((function(t){e.onRejected(t)})),Promise.resolve()}var m=n(261),I=n(48),R=n(219);n.d(t,"b",(function(){return q})),n.d(t,"c",(function(){return x})),n.d(t,"a",(function(){return U}));var C=1,y=8e3,S=3,E=1500,D=null;function q(e,t,n,o){return Object(r.__awaiter)(this,void 0,void 0,(function(){var c,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return c=z(e,o),i=F(P(),c),n=n||Object(R.a)(),null!=i?[3,2]:[4,U(e,t,n,o)];case 1:i=r.sent(),r.label=2;case 2:return[2,null!=i?i.AccessToken:void 0]}}))}))}function x(e,t,n,r){n=n||Object(R.a)();var o=z(e,r),c=F(P(),o);if(c)return[c.AccessToken,void 0];if(Object(T.i)("auth-getAccessTokenQueueEnabled")){var i=Object(m.a)(o),u=void 0;return i?u=i:(u=A(e,n,t,r),Object(m.b)(o,u)),[void 0,u.then((function(e){return Object(m.c)(o),e.AccessToken})).catch((function(c){Object(m.c)(o),Object(I.h)(_,{category:"Promise_For_Token_Request_Failed",err:c?c.toString():"",message:c?c.message:"",stk:c?c.stack:"",resource:e,requestId:n,targetTenantId:r||"",api:t})}))]}return[void 0,U(e,t,n,r).then((function(e){return e.AccessToken}))]}function U(e,t,n,o){return Object(r.__awaiter)(this,void 0,void 0,(function(){var c,u,s,a;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return Object(T.i)("auth-getAccessTokenQueueEnabled")?[4,p(e,S,E,n,t,o)]:[3,2];case 1:return u=r.sent(),[3,4];case 2:return[4,v(e,S,n,t,o)];case 3:u=r.sent(),r.label=4;case 4:return null!=(c=u)&&0==c.TokenResultCode&&null!=c.AccessTokenExpiry&&(c.ExpiresIn&&c.ExpiresIn>0&&(c.AccessTokenExpiry=Object(i.a)(Date.now(),c.ExpiresIn).toISOString()),s=z(e,o),(a=new Date(c.AccessTokenExpiry).getTime()-Date.now()-y)>0&&P().put(s,c,a,(function(r,c){U(e,t,n,o).catch((function(e){Object(I.h)(_,{category:"Cache_Expired",err:e?e.toString():"",message:e?e.message:"",stk:e?e.stack:"",resource:r,requestId:n,targetTenantId:o||"",api:t})}))}))),[2,c]}}))}))}function F(e,t){var n=e.get(t),r=void 0;(null==n?void 0:n.AccessTokenExpiry)&&n.AccessToken&&(Object(c.a)(new Date(n.AccessTokenExpiry),-C)>new Date(Date.now())&&(r=n));return r}function P(){return null==D&&(D=new o.Cache),D}function z(e,t){return t?e+"|"+t:e}}}]);
//# sourceMappingURL=owa.3.js.map
self.scriptsLoaded['owa.3.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.3.js'] = (new Date()).getTime();