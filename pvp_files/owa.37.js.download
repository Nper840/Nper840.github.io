self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.37.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[37],{1141:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(2),c=Object(r.action)("logCacheUpdateForDiagnostics",(function(e){return{cacheUpdateLog:e}}))},207:function(e,t,n){"use strict";n.d(t,"g",(function(){return o})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return d})),n.d(t,"f",(function(){return f})),n.d(t,"a",(function(){return l})),n.d(t,"h",(function(){return v}));var r=n(0),c=n(259),a=n(260);function o(e,t){var n=Object(c.a)().calendarFolderEvents.get(t);return n?n.locksInfo.get(e):null}function u(e){var t=f(e);return t?Object(r.__spread)(t.locksInfo.entries()).reduce(Object(a.c)(),[]):[]}function i(e){var t=f(e);return t?Object(r.__spread)(t.locksInfo.entries()).reduce(Object(a.d)(),{}):{}}function s(e,t){var n=f(e);return n?Object(r.__spread)(n.locksInfo.entries()).reduce(Object(a.e)(Object(a.m)(t)),[]):[]}function d(){var e=Object(c.a)();return Object(r.__spread)(e.calendarFolderEvents.keys())}function f(e){return Object(c.a)().calendarFolderEvents.get(e)||null}function l(e){var t=f(e);return(null==t?void 0:t.events)?Object(r.__spread)(t.events.values()):[]}function v(e){return!!f(e)}},259:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(2),c=n(9),a={calendarFolderEvents:new c.ObservableMap,fullItemsMruMap:new c.ObservableMap,calendarFolderWorkingHours:new c.ObservableMap},o=Object(r.createStore)("calendarEventsStore",a)},260:function(e,t,n){"use strict";var r=n(0);function c(e,t){t.locksInfo.get(e)||t.locksInfo.set(e,{lockedDateRange:null,lockedEvents:{}})}var a=n(919),o=n(9),u=n(18);function i(e,t,n){void 0===n&&(n=!1);t.Key;var c,a=Object(r.__rest)(t,["Key"]);s(e,n?a:(c=a,Object.keys(c).reduce((function(e,t){return void 0!==c[t]&&(e[t]=c[t]),e}),{})))}function s(e,t){if(e!==t){var n=Array.isArray(e)||Object(o.isObservableArray)(e),c=Array.isArray(t)||Object(o.isObservableArray)(t);if(n||c){var i=e,f=t;if(!e&&c)return f.length>0?f:i;if(!t&&n)return i.length>0&&i.splice(0),i;if(n&&c){if(i.length===f.length&&i.length>0)for(var l=0;l<i.length;l++)d(i[l])?Object(a.a)(i[l],f[l],s):i[l]=f[l];else i.length!==f.length&&(i.splice(0),i.push.apply(i,Object(r.__spread)(f)));return i}return f}if(d(e)&&d(t)){if(Object(u.i)("cal-event-mergeReplaceNonObservable")&&!Object(o.isObservable)(e))return;return Object(a.a)(e,t,s)}}}function d(e){return"[object Object]"===Object.prototype.toString.call(e)}var f=n(4),l=n(386);function v(e,t,n){void 0===n&&(n=!1);var r=function(e,t,n){for(var r=[],c=0;c<e.length;c++){var a=e[c],o=t.get(a.Key);o?(i(o,a,n),r.push(o)):r.push(a)}return r}(e,t,n);return r.forEach((function(e){t.set(e.Key,e)})),function(e){e.sort((function(e,t){return Object(f.p)(e.Start,t.Start)}))}(r),Object(l.a)({lockId:"",updateMessage:"Upserted "+r.length+" items in the cache"}),r}function g(e,t,n,a,o){void 0===a&&(a=!1),void 0===o&&(o=!1),c(t,n);var u=n.events;if(a){var s=u.get(e.Key);s&&(i(s,e,o),e=s)}var d=Object(r.__read)(v([e],u,o),1)[0];return n.locksInfo.get(t).lockedEvents[e.Key]=!0,Object(l.a)({lockId:t,updateMessage:"Event with startTime "+d.Start+" added to the lock"}),d}var b=n(132);function j(e,t){for(var n={start:e.Start,end:e.End},r=0;r<t.length;r++)if(0===Object(b.j)(t[r],n,!0))return!0;return!1}function O(e,t,n){var r=n.dateRangesToRetain,c=n.eventsToRetain;return function(e,t,n){var r=t.dateRangesToRetain,c=t.eventsToRetain,a=[];return e.forEach((function(e,t){var o=j(e,[n]),u=j(e,r),i=c[e.Key]||u;o&&!i&&a.push(e)})),a.forEach((function(t){e.delete(t.Key)})),a}(t,{dateRangesToRetain:r.filter((function(t){return 0===Object(b.j)(t,e,!0)})),eventsToRetain:c},e)}function k(e,t,n){var r=[];return t.forEach((function(t){-1!==e.indexOf(t.Key)&&function(e,t){var n=t.dateRangesToRetain,r=t.eventsToRetain;return!j(e,n)&&!r[e.Key]}(t,n)&&r.push(t)})),r.forEach((function(e){t.delete(e.Key)})),r}function h(e){return void 0===e&&(e=function(){return!0}),function(t,n){var c=Object(r.__read)(n,2),a=c[0],o=c[1];return e([a,o])&&Object.keys(o.lockedEvents).forEach((function(e){return t[e]=!0})),t}}function p(e){return void 0===e&&(e=function(){return!0}),function(t,n){var c=Object(r.__read)(n,2),a=c[0],o=c[1];return e([a,o])&&o.lockedDateRange&&t.push(o.lockedDateRange),t}}function R(e){return void 0===e&&(e=function(){return!0}),function(t,n){var c=Object(r.__read)(n,2),a=c[0],o=c[1];return e([a,o])&&t.push(a),t}}function E(e){return function(t){var n=Object(r.__read)(t,2),c=(n[0],n[1]);return c.lockedDateRange&&0===Object(b.j)(c.lockedDateRange,e,!1)}}var _,I=function(e){return function(t){return Object(r.__read)(t,1)[0]!==e}};function y(e,t,n){c(t,n);var a=n.locksInfo.get(t),o=a.lockedDateRange,u=a.lockedEvents,i=Object(r.__spread)(n.locksInfo.entries()).reduce(p(e!==_.EventIds?I(t):function(){return!0}),[]),s=Object(r.__spread)(n.locksInfo.entries()).reduce(h(e!==_.DateRange?I(t):function(){return!0}),{});!o||e!==_.All&&e!==_.DateRange||(O(o,n.events,{dateRangesToRetain:i,eventsToRetain:s}),a.lockedDateRange=null);var d=Object.keys(u);d.length>0&&(e===_.All||e===_.EventIds)&&(k(d,n.events,{dateRangesToRetain:i,eventsToRetain:s}),a.lockedEvents={})}!function(e){e[e.All=0]="All",e[e.DateRange=1]="DateRange",e[e.EventIds=2]="EventIds"}(_||(_={}));var D=n(20);function w(e,t,n,r){c(n,r);var a,o,u=r.locksInfo.get(n).lockedDateRange,i=u?u.start+" - "+u.end:"null";u&&(a=u,o=e,0==Object(b.j)(a,o,!0)||function(e,t){return 1==(Object(f.p)(e.start,t.start)<0?Object(f.w)(t.start,e.end):Object(f.w)(e.start,t.end))}(a,o))&&!Object(b.c)(e,u,!0)?Object(b.c)(u,e,!0)?D.g.info("[addEventsForLock]: Date range in lock "+n+" already contains the range to be added."):u=Object(b.f)(u,e):(D.g.info('[addEventsForLock] Replacing all items in cache for lock "'+n+'". Date range: '+e.start+" - "+e.end),y(_.DateRange,n,r),u=e);var s=v(t,r.events);return r.locksInfo.get(n).lockedDateRange=u,D.g.info('[addEvents] New range in cache for lock "'+n+'": '+u.start+" - "+u.end),Object(l.a)({lockId:n,updateMessage:s.length+" events added to the lock. Previous locked daterange: "+i+". New locked daterange: "+u.start+" - "+u.end}),s}function m(e,t,n){var r=t.events.size,c=[];t.events.forEach((function(e,t){var r={start:e.Start,end:e.End};n.some((function(e){return 0===Object(b.j)(r,e,!0)}))&&c.push(t)})),c.forEach((function(e){t.events.delete(e)})),e.forEach((function(e){t.events.set(e.Key,e)})),Object(l.a)({lockId:"",updateMessage:"Replaced "+c.length+" items of initial "+r+" from cache with "+e.length+" items"})}function T(e,t,n){if(0===e.length)return[];c(t,n);var a=n.locksInfo.get(t);e=e.filter((function(e){return a.lockedEvents[e]}));var o=Object(r.__spread)(n.locksInfo.entries()).reduce(p(),[]),u=Object(r.__spread)(n.locksInfo.entries()).reduce(h(I(t)),{}),i=k(e,n.events,{dateRangesToRetain:o,eventsToRetain:u});return e.forEach((function(e){delete a.lockedEvents[e]})),i}function K(e,t,n){c(t,n);var a=n.locksInfo.get(t),o=a.lockedDateRange;if(o&&!Object(b.c)(e,a.lockedDateRange,!0)){Object(l.a)({lockId:t,updateMessage:"Now evicting events in cache except for events in date range "+e.start+" - "+e.end+". Current locked cache range: "+o.start+" - "+o.end});var u=Object(r.__spread)(n.locksInfo.entries()).reduce(p(I(t)),[e]),i=Object(r.__spread)(n.locksInfo.entries()).reduce(h(),{}),s=O(o,n.events,{dateRangesToRetain:u,eventsToRetain:i});D.g.info("[owa-events-cache:evictEventsExceptInDateRangeForLock] Evicted "+s.length+" events for lock '"+t+"'"),Object(b.c)(o,e,!0)?a.lockedDateRange=Object(r.__assign)({},e):a.lockedDateRange=function(e,t){var n=-1===Object(f.p)(e.start,t.start),r=1===Object(f.p)(e.end,t.end),c=e.start,a=e.end;n&&(c=t.start);r&&(a=t.end);return{start:c,end:a}}(e,o),Object(l.a)({lockId:t,updateMessage:"Evicted "+s.length+" events for lock. New locked cache range: "+o.start+" - "+o.end})}}function M(e,t){var n=t.events,c=[];return n.forEach((function(t,n){e(t)&&c.push(t)})),c.forEach((function(e){n.delete(e.Key)})),function(e,t){Object(r.__spread)(t.locksInfo.keys()).forEach((function(n){var r=t.locksInfo.get(n);e.forEach((function(e){return delete r.lockedEvents[e.Key]}))}))}(c,t),Object(l.a)({lockId:"",updateMessage:"Unloaded "+c.length+" items from cache"}),c.reverse()}function A(e,t){y(_.All,e,t),t.locksInfo.delete(e)}function S(e,t){var n=[];return t.forEach((function(t){var r={start:t.Start,end:t.End};0===Object(b.j)(e,r,!0)&&n.push(t)})),n}var F=n(5);function N(e,t,n){var r=n&&n.locksInfo.get(t)?n.locksInfo.get(t).lockedDateRange:null;if(null!=r&&Object(b.c)(r,e,!0)){var c=S(e,n.events);if(Object(F.d)("debugEventsCache")){var a=c?c.length:"no";Object(l.a)({lockId:t,updateMessage:"Returning "+a+" items from cache for date range: "+e.start+" - "+e.end})}return c}return null}function L(e,t,n){var r=n.locksInfo.get(t)||{},c=r.lockedDateRange,a=void 0===c?null:c,o=r.lockedEvents,u=void 0===o?[]:o;return null===a&&0===Object.keys(u).length?e.map((function(e){return null})):function(e,t,n){var r=n.locksInfo.get(t),c=r.lockedDateRange,a=r.lockedEvents,o={};return e.forEach((function(e){var t=n.events.get(e);if(t){var r={start:t.Start,end:t.End};(!!c&&0===Object(b.j)(c,r,!0)||a[t.Key])&&(o[t.Key]=t)}})),e.map((function(e){return o[e]||null}))}(e,t,n)}var U=0;function x(e){var t=e||"events_cache_lock_"+U;return U++,t}function C(){return{events:new o.ObservableMap,locksInfo:new o.ObservableMap}}n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return w})),n.d(t,"r",(function(){return v})),n.d(t,"p",(function(){return m})),n.d(t,"i",(function(){return T})),n.d(t,"h",(function(){return K})),n.d(t,"o",(function(){return M})),n.d(t,"n",(function(){return A})),n.d(t,"q",(function(){return i})),n.d(t,"k",(function(){return N})),n.d(t,"j",(function(){return S})),n.d(t,"l",(function(){return L})),n.d(t,"g",(function(){return x})),n.d(t,"f",(function(){return C})),n.d(t,"c",(function(){return p})),n.d(t,"d",(function(){return h})),n.d(t,"e",(function(){return R})),n.d(t,"m",(function(){return E}))},386:function(e,t,n){"use strict";var r=n(1141),c=n(18),a=function(e){Object(c.i)("cal-cacheDiagnostics")&&setTimeout((function(){return Object(r.a)(e)}),0)};n.d(t,"a",(function(){return a}))},919:function(e,t,n){"use strict";var r=n(507),c=n(1032),a=n(576),o=Object(c.a)((function(e,t,n,c){Object(r.a)(t,Object(a.a)(t),e,c)}));t.a=o}}]);
//# sourceMappingURL=owa.37.js.map
self.scriptsLoaded['owa.37.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.37.js'] = (new Date()).getTime();