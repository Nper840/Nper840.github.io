self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~owa-account-store-init.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[845],{1597:function(e,n,t){"use strict";t.r(n);var r=t(0),o=t(71),c=t(895),u=t(365),i=t(1662),a=t(235),s=t(3146),d=t(369);var b={};function l(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,l,f,O;return Object(r.__generator)(this,(function(p){return t=e.userIdentity,l=Object(o.i)(t),f=b[t],l&&!f?[2,Promise.resolve()]:f?[2,f.requestPromise]:(O=function(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,b,l,f,O,p,j,v,w;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:t=e.userIdentity,b=e.accountProviderType,r.label=1;case 1:return r.trys.push([1,6,,7]),Object(u.d)(e),l=Object(a.d)(t),[4,Object(i.b)(Object(d.a)(l))];case 2:return f=r.sent(),O=Object(u.s)(t),f.headers&&O?[4,Object(s.a)(f)]:[3,4];case 3:return p=r.sent(),Object(o.y)(p,t),Object(c.c)(t,b),[3,5];case 4:j=f.headers?"Account invalid ":"Missing headers",Object(c.b)(t,n,b,j),r.label=5;case 5:return[3,7];case 6:return v=r.sent(),w="Exception"+v,Object(c.b)(t,n,b,w),[3,7];case 7:return[2]}}))}))}(e,n),b[t]={requestPromise:O},[2,O])}))}))}var f=t(2692),O=t(2),p=t(111),j=t(18),v=t(4),w=t(127);function S(e){return e<=0?{lowerBoundSeconds:null,upperBoundSeconds:0}:e<=30?{lowerBoundSeconds:0,upperBoundSeconds:30}:e<=60?{lowerBoundSeconds:30,upperBoundSeconds:60}:e<=300?{lowerBoundSeconds:60,upperBoundSeconds:300}:e<=600?{lowerBoundSeconds:300,upperBoundSeconds:600}:e<=1800?{lowerBoundSeconds:600,upperBoundSeconds:1800}:e<=3600?{lowerBoundSeconds:1800,upperBoundSeconds:3600}:e<=21600?{lowerBoundSeconds:3600,upperBoundSeconds:21600}:e<=43200?{lowerBoundSeconds:21600,upperBoundSeconds:43200}:e<=86400?{lowerBoundSeconds:43200,upperBoundSeconds:86400}:e>86400?{lowerBoundSeconds:86400,upperBoundSeconds:null}:{lowerBoundSeconds:null,upperBoundSeconds:null}}function A(e){switch(e.providerType){case f.c.Msa:case f.c.MsaInt:return!0;case f.c.Google:return Object(j.i)("cal-addCalendar-google");case f.c.TeamSnap:return!1;case f.c.ICloud:return Object(j.i)("cal-addCalendar-iCloud");default:return Object(p.a)(e.providerType)}}Object(O.orchestrator)(c.a,(function(){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var e,n,t,o;return Object(r.__generator)(this,(function(c){switch(c.label){case 0:return(e=Object(u.h)())==u.a.AccountsLoadSuccessful||e==u.a.Loading?[2]:(Object(u.w)(u.a.Loading),[4,f.e.importAndExecute()]);case 1:return n=c.sent(),t=n,o=null==n?void 0:n.isSuccess,t.ConnectedAccountResponses&&"function"==typeof t.ConnectedAccountResponses.filter?[4,Promise.all(t.ConnectedAccountResponses.filter(A).map((function(e){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var n,t;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n=function(e){switch(e){case f.c.Msa:return"Outlook";case f.c.Google:return"Google";case f.c.ICloud:return"ICloud";default:return Object(p.a)(e)}}(e.providerType),t=parseInt(e.token.expiresIn),Object(w.r)("hasConnectedAccount",{tokenExpiry:t,type_1:n,tokenExpiryLowerBound_3:S(t).lowerBoundSeconds,tokenExpirtyUpperBound_4:S(t).upperBoundSeconds},{isCore:!0}),[4,l({userIdentity:e.userAccount.emailAddress,accountId:e.userAccount.id,accountUniqueId:e.userAccount.accountUniqueId,anchorMailbox:e.userAccount.routingHint,token:e.token.accessToken,tokenExpiry:Object(v.j)(Object(v.Qb)(),t),accountProviderType:n,accountState:u.b.Valid},!1)];case 1:return r.sent(),Object(u.l)(e.userAccount.emailAddress)!=u.b.Valid&&(o=!1),[2]}}))}))})))]:[3,3];case 2:c.sent(),c.label=3;case 3:return Object(u.e)(o),[2]}}))}))})),Object(O.orchestrator)(c.d,(function(e){var n=e.userIdentity;Object(u.u)(n),Object(o.x)(n),Object(a.f)(n),function(e){delete b[e]}(n)}));var h=t(1705);Object(O.orchestrator)(h.b,(function(e){l(Object(u.k)(e.userIdentity),!0)})),Object(O.orchestrator)(c.b,(function(e){var n=e.userIdentity,t=e.isRetry,r=e.accountProvider,o=e.error;(Object(w.r)("owaAccountStoreInitializationFailed",{error:o,accountProvider:r,isRetry:t},{isCore:!0}),t)?Object(u.x)(n,u.b.FailedToInitializeOWAConfig):l(Object(u.k)(n),!0)})),t.d(n,"initializeOwaAccountsStore",(function(){return c.a})),t.d(n,"removeOWAConnectedAccount",(function(){return c.d})),t.d(n,"owaAccountStoreInitializationFailed",(function(){return c.b})),t.d(n,"initializeOwaConnectedAccount",(function(){return l}))},161:function(e,n,t){"use strict";t.d(n,"d",(function(){return c})),t.d(n,"c",(function(){return u})),t.d(n,"e",(function(){return i})),t.d(n,"b",(function(){return a})),t.d(n,"a",(function(){return s})),t.d(n,"f",(function(){return d}));var r=t(37),o=new r.c((function(){return Promise.all([t.e(3),t.e(22),t.e(914)]).then(t.bind(null,1262))})),c=new r.a(o,(function(e){return e.makePostRequest})).importAndExecute,u=new r.a(o,(function(e){return e.makePatchRequest})).importAndExecute,i=new r.a(o,(function(e){return e.makePutRequest})).importAndExecute,a=new r.a(o,(function(e){return e.makeGetRequest})).importAndExecute,s=new r.a(o,(function(e){return e.makeDeleteRequest})).importAndExecute,d=new r.a(o,(function(e){return e.sendOwsPrimeRequest})).importAndExecute},1662:function(e,n,t){"use strict";var r=t(0),o=t(1705),c=t(365),u=t(614),i=t(127),a=t(4),s="X-AnchorMailbox",d="Authorization",b="X-OwaWebSessionType",l="X-OWA-ExplicitLogonUser";function f(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,f,O,p,j;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(t={},f=Object(c.k)(e)){if(f.accountState==c.b.AccessRevoked)return[2,null];if(f.accountState==c.b.AccountDeprovisioned||f.accountState==c.b.AccountNotFound)return Object(c.c)(f.accountState,f.accountProviderType),[2,null]}return n?(t[s]=n,t[l]=n):f&&(t[s]=f.anchorMailbox),f?(O=f.token,!(p=Object(u.g)(f.tokenExpiry))&&O?[3,2]:(Object(i.r)("getAndUpdateAccessToken",{tokenExpiry:Object(a.y)(f.tokenExpiry,Object(a.Qb)()),isTokenExpired_1:p,isTokenInvalid_2:!O},{isCore:!0}),[4,o.a.importAndExecute(f.accountId,e,O)])):[3,3];case 1:(O=r.sent())||(O=""),r.label=2;case 2:j=void 0,"Outlook"==f.accountProviderType?(j='MSAuth1.0 usertoken="'+O+'", type="MSACT"',t[b]=1..toString()):"Google"!=f.accountProviderType&&"ICloud"!=f.accountProviderType||(j="Bearer "+O,t[b]=2..toString()),t[d]=j,r.label=3;case 3:return[2,t]}}))}))}var O=t(1663),p=t(20);function j(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=Object(O.a)(),o=t,[4,v(e,n)];case 1:return o.headers=r.sent(),t.authNeededOnUnAuthorized=!1,t.datapoint=t.datapoint||{},t.datapoint.mailbox="Connected",[2,t]}}))}))}function v(e,n){var t;return Object(r.__awaiter)(this,void 0,void 0,(function(){var o,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return o=n&&(null===(t=e.headers)||void 0===t?void 0:t.set)?new Headers(e.headers):new Headers,[4,f(e.mailboxInfo.userIdentity,w(e.mailboxInfo.type,e.mailboxInfo.mailboxSmtpAddress)?e.mailboxInfo.mailboxSmtpAddress:null)];case 1:return c=r.sent(),Object(O.b)(o,c),[2,o]}}))}))}function w(e,n){var t="GroupMailbox"==e||"TeamsMailbox"==e||"SharedMailbox"==e||"PublicMailbox"==e;return t&&null==n&&p.d("getHeadersForConnectedAccount: mailboxSmtpAddress should be passed for Group or Teams or Shared or Public Mbx request"),t}t.d(n,"a",(function(){return f})),t.d(n,"b",(function(){return j})),t.d(n,"c",(function(){return w}))},1663:function(e,n,t){"use strict";function r(e,n){Object.keys(n).forEach((function(t){return e.set(t,n[t])}))}function o(e){var n=null!=e?e:{headers:new Headers};return n.datapoint=n.datapoint||{},n.datapoint.mailbox="Default",n}t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return o}))},1665:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(2),o=Object(r.action)("triggerReInitializeAccount",(function(e){return{userIdentity:e}}))},1705:function(e,n,t){"use strict";t.d(n,"a",(function(){return u}));var r=t(37),o=t(1665);t.d(n,"b",(function(){return o.a}));var c=new r.c((function(){return t.e(1302).then(t.bind(null,1915))})),u=new r.a(c,(function(e){return e.getAndUpdateAccessToken}))},236:function(e,n,t){"use strict";var r=t(699);t.d(n,"a",(function(){return r.a}))},2453:function(e,n,t){"use strict";var r;t.d(n,"a",(function(){return r})),function(e){e[e.AccessRevoked=0]="AccessRevoked",e[e.AccountNotFound=1]="AccountNotFound",e[e.InvalidClient=2]="InvalidClient",e[e.InvalidCredentials=3]="InvalidCredentials",e[e.InvalidProvider=4]="InvalidProvider",e[e.MailboxDeprovisioned=5]="MailboxDeprovisioned",e[e.Transient=6]="Transient",e[e.PermissionDenied=7]="PermissionDenied",e[e.UserCancelled=8]="UserCancelled",e[e.AadAuth=9]="AadAuth",e[e.Unknown=10]="Unknown",e[e.ProviderUnavailable=11]="ProviderUnavailable",e[e.TooManyRequests=12]="TooManyRequests"}(r||(r={}))},2692:function(e,n,t){"use strict";var r=t(37),o=t(2780),c=t(2453),u=t(3483);function i(e){return Object(u.a)(e)}t.d(n,"g",(function(){return s})),t.d(n,"e",(function(){return d})),t.d(n,"h",(function(){return b})),t.d(n,"f",(function(){return l})),t.d(n,"i",(function(){return f})),t.d(n,"c",(function(){return o.b})),t.d(n,"a",(function(){return o.a})),t.d(n,"b",(function(){return c.a})),t.d(n,"d",(function(){return i}));var a=new r.c((function(){return Promise.all([t.e(0),t.e(1),t.e(2),t.e(4),t.e(8),t.e(20),t.e(22),t.e(846)]).then(t.bind(null,17372))})),s=new r.a(a,(function(e){return e.linkAccountAndGetAccessToken})),d=new r.a(a,(function(e){return e.getAllConnectedAccounts})),b=(new r.a(a,(function(e){return e.getConnectedAccount})),new r.a(a,(function(e){return e.addConnectedAccount})),new r.a(a,(function(e){return e.removeConnectedAccount}))),l=(new r.a(a,(function(e){return e.refreshConnectedAccountAccessToken})),new r.a(a,(function(e){return e.idpResponseHandler}))),f=new r.a(a,(function(e){return e.setAddConnectedAccountHandler}));"undefined"!=typeof window&&void 0!==window.Owa&&(window.Owa.lazyIdpResponseHandler=l)},2780:function(e,n,t){"use strict";var r,o;t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return o})),function(e){e.Msa="Msa",e.TeamSnap="TeamSnap",e.MsaInt="MsaInt",e.Google="Google",e.ICloud="ICloud"}(r||(r={})),function(e){e.Active="Active",e.Revoked="Revoked",e.Error="Error"}(o||(o={}))},3146:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(30);function o(e){return Object(r.a)("GetOwaUserConfiguration",{},e)}},3483:function(e,n,t){"use strict";t.d(n,"a",(function(){return d}));var r=t(0),o=t(6),c=t(161),u=t(2453),i=t(236),a=t(3484),s="ows/beta/ConnectedAccounts/refreshtoken/{0}";function d(e){var n=this;return Object(c.c)(Object(o.c)(s,e),null,void 0,!0).then((function(e){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n,t,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.json()];case 1:return n=r.sent(),t=n,Object(a.a)("refreshToken_serviceResponse",e,t),Object(i.a)(e.status)?[2,{ConnectedAccountResponse:n,isSuccess:!0}]:400==e.status||404==e.status?[2,{errorResponse:n,isSuccess:!1}]:429==e.status?(o=Number(e.headers.get("RetryAfter").slice(-2)),Object(a.b)(o,"refreshAccountToken"),[2,{errorResponse:{error:u.a[u.a.TooManyRequests]},isSuccess:!1,retryAfter:o}]):[2,{errorResponse:{error:u.a[u.a.Transient]},isSuccess:!1}]}}))}))})).catch((function(e){return{errorResponse:{error:u.a[u.a.Unknown],errorDescription:JSON.stringify(e)},isSuccess:!1}}))}},3484:function(e,n,t){"use strict";t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return u}));var r=t(127),o=t(236);function c(e,n,t){var c=Object(o.a)(n.status);Object(r.r)(e,{isSuccess_1:c,status_2:n.status,errorCode:c?null:JSON.stringify(null==t?void 0:t.error),errorDescription:c?null:JSON.stringify(null==t?void 0:t.errorDescription)})}function u(e,n){var t={lowerBoundSeconds:null,upperBoundSeconds:null};t=e<=0?{lowerBoundSeconds:null,upperBoundSeconds:0}:e<=1?{lowerBoundSeconds:0,upperBoundSeconds:1}:e<=2?{lowerBoundSeconds:1,upperBoundSeconds:2}:e<=5?{lowerBoundSeconds:2,upperBoundSeconds:5}:e<=10?{lowerBoundSeconds:5,upperBoundSeconds:10}:e<=30?{lowerBoundSeconds:10,upperBoundSeconds:30}:e>60?{lowerBoundSeconds:30,upperBoundSeconds:60}:{lowerBoundSeconds:null,upperBoundSeconds:null},Object(r.r)("ConnectedAccounts429Error",{retryAfterLowerBound_1:t.lowerBoundSeconds,retryAfterUpperBound_2:t.upperBoundSeconds,apiName_3:n})}},614:function(e,n,t){"use strict";var r=t(2),o=Object(r.action)("initializeOwaObservableDateTime"),c=Object(r.action)("observableNowChanged"),u=Object(r.action)("observableTodayChanged"),i=t(4),a=t(9),s=Object(r.createStore)("ObservableDateTime",{now:0,today:0}),d=Object(a.computed)((function(){return Object(i.mc)(s().now)})),b=function(){return d.get()},l=Object(a.computed)((function(){return Object(i.mc)(s().today)})),f=function(){return l.get()},O=function(e){return Object(i.Hb)(e,b())},p=function(e){return Object(i.Fb)(e,b())},j=function(e){return w(e,i.Hb)},v=function(e){return w(e,i.Ib)},w=function(e,n){return n(Object(i.Xb)(Object(i.mc)(e)),f())};function S(e){if(!e)return"";var n=Object(i.mc)(e);return function(e,n){var t=Object(i.Xb)(e);if(Object(i.Jb)(t,n))return i.ab;var r=function(e){return Object(i.Nb)(t,Object(i.e)(n,-e),n)};if(r(3))return i.ib;if(r(30))return i.hb;return i.Y}(n,f())(n)}function A(e){if(!e)return"";var n=Object(i.mc)(e);return function(e,n){var t=Object(i.Xb)(e);if(Object(i.Jb)(t,n))return i.T;return i.U}(n,f())(n)}function h(e){return e?function(e,n){var t=Object(i.Xb)(e);return Object(i.Jb)(t,n)?Object(i.ab)(e):m(t,n,2)?Object(i.lb)(e):m(t,n,7)?Object(i.H)(Object(i.bb)(e),Object(i.ab)(e)):Object(i.H)(Object(i.J)(e),Object(i.ab)(e))}(Object(i.mc)(e),f()):""}function m(e,n,t){return Object(i.Nb)(e,Object(i.e)(n,-t),n)}var y=Object(r.action)("updateTimes"),B=Object(r.action)("setNow"),g=Object(r.action)("setToday",(function(e){return{today:e}}));Object(r.mutator)(B,(function(){s().now=Object(i.kc)()})),Object(r.mutator)(g,(function(e){var n=e.today;s().today=n}));var k=t(32),_=t(126),C=!1;Object(r.orchestrator)(o,(function(){if(y(),!C){var e=Object(i.Qb)(),n=Object(i.Zb)(Object(i.h)(e,1)),t=Object(i.w)(n,e);setTimeout((function(){return setInterval(y,k.g)}),t),document&&document.addEventListener("visibilitychange",y),C=!0}})),Object(r.orchestrator)(_.l,(function(){y()})),Object(r.orchestrator)(y,(function(){B();var e=Object(i.Ab)(Object(i.lc)()),n=s().today!=e;n&&g(e),c(),n&&u()})),t.d(n,"d",(function(){return o})),t.d(n,"j",(function(){return c})),t.d(n,"l",(function(){return u})),t.d(n,"i",(function(){return b})),t.d(n,"k",(function(){return f})),t.d(n,"g",(function(){return O})),t.d(n,"e",(function(){return p})),t.d(n,"f",(function(){return j})),t.d(n,"h",(function(){return v})),t.d(n,"a",(function(){return S})),t.d(n,"b",(function(){return A})),t.d(n,"c",(function(){return h}))},699:function(e,n,t){"use strict";function r(e){return e>=200&&e<300}t.d(n,"a",(function(){return r}))}}]);
//# sourceMappingURL=owa.MailBoot~owa-account-store-init.js.map
self.scriptsLoaded['owa.MailBoot~owa-account-store-init.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~owa-account-store-init.js'] = (new Date()).getTime();