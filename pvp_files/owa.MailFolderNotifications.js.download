self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailFolderNotifications.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[868],{17488:function(e,n,i){"use strict";i.r(n);var t=i(0),a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"subscribeToHierarchyNotifications"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subscribeToHierarchyNotifications"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"EventType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"folderId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parentFolderId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"itemCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"unreadCount"},arguments:[],directives:[]}]}}]}}]},d=i(713),r=i(2030),o=i(3061),l=i(3463),s=i(3754),c=i(563),u=i(2778),m=i(794),v=i(3832),F=i(168),k=i(966);function g(){var e=Object(s.a)({FolderShape:Object(u.a)({BaseShape:"IdOnly",AdditionalProperties:[Object(m.a)({FieldURI:"TotalCount"}),Object(m.a)({FieldURI:"UnreadCount"})]}),Paging:null,ParentFolderIds:[Object(c.a)({Id:Object(k.a)("msgfolderroot")})],ReturnParentFolder:!0,ShapeName:null,Traversal:"Deep"});return Object(v.a)({Header:Object(F.b)(),Body:e}).then((function(e){var n,i,t;return null===(t=null===(i=null===(n=null==e?void 0:e.Body)||void 0===n?void 0:n.ResponseMessages)||void 0===i?void 0:i.Items)||void 0===t?void 0:t[0]}))}var f=i(20);function b(e){switch(e.EventType){case"Reload":case"QueryResultChanged":g().then((function(e){"Success"==(null==e?void 0:e.ResponseClass)?e.RootFolder.Folders.forEach((function(e){Object(l.a)(e.UnreadCount,e.TotalCount,e.FolderId.Id,!1)})):f.g.warn(h+"ResponseNotSuccess")})).catch((function(e){f.g.warn(h+":"+e.message)}));break;case"RowModified":Object(o.b)(e.unreadCount,e.itemCount,e.folderId,e.displayName,e.parentFolderId),r.h.import().then((function(n){n(e)}));break;case"RowAdded":Object(o.a)(e.folderId,e.parentFolderId,e.displayName,e.unreadCount,e.itemCount),r.h.import().then((function(n){n(e)}));break;default:return}}function N(){return Object(t.__awaiter)(this,void 0,void 0,(function(){var e;return Object(t.__generator)(this,(function(n){switch(n.label){case 0:return[4,Object(d.a)()];case 1:return e=n.sent(),e.subscribe({query:a}).subscribe({next:function(e){return b(e.data.subscribeToHierarchyNotifications)},error:function(e){f.g.warn("Hierarchy notification error "+e)}}),[2]}}))}))}var h="UpdateFolderCountsAction:";var p={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderUpdateNotification"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"UnreadCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"TotalCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"DisplayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"ParentFolderId"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"ChangeKey"},arguments:[],directives:[]}]}}]}}]},O={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"NewFolder"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"FolderId"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"ChangeKey"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"ParentFolderId"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"ChangeKey"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"DisplayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"DistinguishedFolderId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"FolderClass"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"UnreadCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"TotalCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"hasChildren"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"childFolderIds"},arguments:[],directives:[]}]}}]},j=i(37),I=i(7852),_=i(11),C=i(6810),y=Object(j.e)(o.a,"onNewFolderNotificationClone",(function(e){return Object(t.__awaiter)(void 0,void 0,void 0,(function(){var n,i,a,r,o,l,s;return Object(t.__generator)(this,(function(c){switch(c.label){case 0:return Object(_.h)("gqlfolders")?(n=e.displayName,i=e.parentFolderId,a=e.folderId,r=e.unreadCount,o=e.totalCount,[4,Object(I.a)(i,a)]):[2];case 1:return(l=c.sent())?[4,Object(d.a)()]:[2];case 2:return(s=c.sent()).writeFragment({id:Object(C.a)(a,s),fragment:O,data:{id:a,UnreadCount:r,TotalCount:o,DisplayName:n,FolderId:{Id:a,ChangeKey:null},ParentFolderId:Object(t.__assign)({},l),DistinguishedFolderId:null,childFolderIds:[],hasChildren:!1,type:"Folder:#Exchange",FolderClass:"IPF.Note",__typename:"MailFolder"}}),[2]}}))}))})),S=Object(j.e)(o.b,"onUpdateFolderNotificationClone",(function(e){return Object(t.__awaiter)(void 0,void 0,void 0,(function(){var n,i,a,r,o,l,s,c;return Object(t.__generator)(this,(function(t){switch(t.label){case 0:return Object(_.h)("gqlfolders")?(n=e.folderId,i=e.unreadCount,a=e.totalCount,r=e.displayName,o=e.parentFolderId,[4,Object(d.a)()]):[2];case 1:return l=t.sent(),(s=l.readFragment({id:Object(C.a)(n,l),fragment:p}))?[4,Object(I.a)(o,n)]:[2];case 2:return(c=t.sent())?(s&&l.writeFragment({id:Object(C.a)(n,l),fragment:p,data:{UnreadCount:i,TotalCount:a,DisplayName:r,ParentFolderId:c}}),[2]):[2]}}))}))}));i.d(n,"subscribeToHierarchyNotification",(function(){return N})),i.d(n,"onNewFolderNotificationOrchestrator",(function(){return y})),i.d(n,"onUpdateFolderNotificationOrchestrator",(function(){return S}))},2778:function(e,n,i){"use strict";i.d(n,"a",(function(){return a}));var t=i(0);function a(e){return Object(t.__assign)({__type:"FolderResponseShape:#Exchange"},e)}},3754:function(e,n,i){"use strict";i.d(n,"a",(function(){return a}));var t=i(0);function a(e){return Object(t.__assign)({__type:"FindFolderRequest:#Exchange"},e)}},3832:function(e,n,i){"use strict";var t=i(30),a=i(0);function d(e,n){var i;return void 0===e||e.__type||(i=e,e=Object(a.__assign)({__type:"FindFolderJsonRequest:#Exchange"},i)),Object(t.a)("FindFolder",e,n)}i.d(n,"a",(function(){return d}))},6810:function(e,n,i){"use strict";function t(e,n){var i={__typename:"MailFolder",id:e};return n.cache.identify(i)}i.d(n,"a",(function(){return t}))},7852:function(e,n,i){"use strict";var t=i(0),a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderChildFolderIds"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"childFolderIds"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"hasChildren"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"FolderId"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"ChangeKey"},arguments:[],directives:[]}]}}]}}]},d={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderParentFolder"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"ParentFolderId"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"},arguments:[],directives:[]}]}}]}}]},r=i(713),o=i(6810);function l(e,n){return Object(t.__awaiter)(this,void 0,void 0,(function(){var i,d,l;return Object(t.__generator)(this,(function(c){switch(c.label){case 0:return[4,Object(r.a)()];case 1:return i=c.sent(),[4,s(n,e)];case 2:return c.sent(),(d=i.readFragment({id:Object(o.a)(e,i),fragment:a}))?((l=d.childFolderIds).includes(n)||i.writeFragment({id:Object(o.a)(e,i),fragment:a,data:{childFolderIds:Object(t.__spread)(l,[n]),hasChildren:!0,FolderId:d.FolderId}}),[2,d.FolderId]):[2,null]}}))}))}function s(e,n){return Object(t.__awaiter)(this,void 0,void 0,(function(){var i,l,s,c,u;return Object(t.__generator)(this,(function(m){switch(m.label){case 0:return[4,Object(r.a)()];case 1:return i=m.sent(),(l=i.readFragment({id:Object(o.a)(e,i),fragment:d}))?(s=l.ParentFolderId.Id)==n?[2]:(c=i.readFragment({id:Object(o.a)(s,i),fragment:a}))?((u=Object(t.__spread)(c.childFolderIds)).splice(u.indexOf(e),1),i.writeFragment({id:Object(o.a)(s,i),fragment:a,data:{childFolderIds:Object(t.__spread)(u),hasChildren:u.length>0,FolderId:c.FolderId}}),[2]):[2,null]:[2]}}))}))}i.d(n,"a",(function(){return l}))}}]);
//# sourceMappingURL=owa.MailFolderNotifications.js.map
self.scriptsLoaded['owa.MailFolderNotifications.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailFolderNotifications.js'] = (new Date()).getTime();